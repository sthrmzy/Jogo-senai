using System.Collections;
using UnityEngine;
using TMPro;

public class DialogueSystem : MonoBehaviour
{
    public TextMeshProUGUI dialogueText; //ref ao objeto de texto onde o diálogo será exibido
    public GameObject dialoguePanel; // ref ao vetor de dialogo

    private string[] currentDialogue; // os textos que o personagem apresenta
    private int dialogueIndex = 0; //indice do dialogo que ele esta(meio que a pagina caso ele tenha mais de um dialogo)

    void Start()
    {
        CloseDialogue(); // inicia e fecha o diálogo
    }

    void Update()
    {
        if (Input.GetKeyDown(KeyCode.Space))  //especifica que a tecla cliclada pra abrir o texto e o espaço
        {
            if (IsDialogueOpen())
            {
                // se a caixa de dialogo estiver aberta o codigo verifica se tem mais texto pra mostrar
                if (dialogueIndex < currentDialogue.Length - 1)
                {
                    // se tiver mais texto vai avancar pro prixmo
                    dialogueIndex++;
                    dialogueText.text = currentDialogue[dialogueIndex];
                }
                else
                {
                    // se nao tiver mais texto a caixa fecha 
                    CloseDialogue();
                }
            }
            else
            {
                // se vc estiver perto do personagem e clicar no espaco e o dialogo estiver fechado ira abrir
                OpenDialogue(currentDialogue); // Passe o conjunto de diálogos do NPC atual.
            }
        }
    }

    // abre o diálogo com o texto do npc atual
    public void OpenDialogue(string[] npcDialogue)
    {
        currentDialogue = npcDialogue;
        dialogueIndex = 0;
        dialogueText.text = currentDialogue[dialogueIndex];
        dialoguePanel.SetActive(true);
    }

    // fecha a caixa de dialogo
    public void CloseDialogue()
    {
        currentDialogue = null;
        dialogueIndex = 0;
        dialogueText.text = "";
        dialoguePanel.SetActive(false);
    }

    // verifica se o dialogo esta aberto pela logica de boolean 
    public bool IsDialogueOpen()
    {
        return currentDialogue != null;
    }
}
